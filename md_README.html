<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PiWx: PiWx: Raspberry Pi Aviation Weather</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PiWx
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">PiWx: Raspberry Pi Aviation Weather </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><img src="doc/images/sample.png" alt="Weather Display" class="inline"/></p>
<p >PiWx is a configurable aviation METAR display designed to work with the Adafruit 320x240 PiTFT framebuffer display. While PiWx is hard-coded to work with the PiTFT, it should not be difficult to modify it for any display that uses a framebuffer device.</p>
<p >For more information about the PiTFT: <a href="https://www.adafruit.com/product/2298">https://www.adafruit.com/product/2298</a>.</p>
<p >The amazing weather icons are from the Weather Underground Icons project: <a href="https://github.com/manifestinteractive/weather-underground-icons">https://github.com/manifestinteractive/weather-underground-icons</a></p>
<p >The font used is San Francisco Monospace (SF Mono) from Xcode.</p>
<h1>NOTICE </h1>
<p >Use of this program in no way satisfies any regulatory requirement for pre- flight planning action in any country.</p>
<h1>Building </h1>
<p >PiWx uses CMake 3.27 to build. The following dependencies must be installed:</p>
<ul>
<li>OpenGL ES 2 and EGL (Mesa drivers on Raspberry Pi OS are fine)</li>
<li>pigpio (<a href="https://abyz.me.uk/rpi/pigpio/">https://abyz.me.uk/rpi/pigpio/</a>)</li>
<li>Bison (<a href="https://www.gnu.org/software/bison/">https://www.gnu.org/software/bison/</a>)</li>
<li>Flex (<a href="https://github.com/westes/flex">https://github.com/westes/flex</a>)</li>
<li>LibXml2 (<a href="http://www.xmlsoft.org/">http://www.xmlsoft.org/</a>)</li>
<li>libcURL (<a href="https://curl.haxx.se/libcurl/">https://curl.haxx.se/libcurl/</a>)</li>
<li>libpng (<a href="http://www.libpng.org/pub/png/libpng.html">http://www.libpng.org/pub/png/libpng.html</a>)</li>
<li>ws2811 [optional] (<a href="https://github.com/jgarff/rpi_ws281x.git">https://github.com/jgarff/rpi_ws281x.git</a>)</li>
</ul>
<p >After cloning the repository, use the following commands to perform a simple build: </p><pre class="fragment">% git clone https://github.com/slakpi/piwx.git
% cd piwx
% cmake -B build -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr/local .
% cd build
% make
% sudo make install
</pre><p> LED support requires the <code>ws2811</code> library listed above. If the <code>ws2811</code> library is available on the system, PiWx will build with LED support enabled.</p>
<h1>Configuration </h1>
<p >Configuration is relatively simple. Refer to the sample configuration file that installs to the <code>etc</code> directory under the install prefix. Simply copy the sample to a new file called <code>piwx.conf</code>. </p><pre class="fragment"># Comma-separated list of aiports; used directly in the URL query.
stations="KHIO,KMMV,KUAO,KVUO,KSLE,KSPB,KTPA,KCGC,KGNV,KDEN";

# Airport METAR display cycle time in seconds.
cycletime=5;
</pre><p> The Aviation Weather data API does not return stations in any particular order. The <code>sort</code> option allows sorting stations lexicographically, geographically, or in the order specified by the configuration file. </p><pre class="fragment"># Sort by geographical position.
sort=position;
</pre><p> If <code>sort</code> is set to <code>off</code> or is not specified, stations are displayed in the order received from the Aviation Weather data API. When set to <code>on</code> or <code>position</code>, stations are displayed from West to East and North to South. When set to <code>alpha</code>, stations are displayed in lexicographical order, e.g. <code>77S</code> sorts before <code>KAST</code>, and <code>KAST</code> sorts before <code>KTPA</code>. When set to <code>query</code>, stations are displayed in the order specified by the <code>stations</code> query.</p>
<p >With LED support enabled, PiWx will drive a 50-LED WS281x strip to display flight categories at select airports. The <code>led&lt;num&gt;</code> option assigns an airport to a LED where <code>&lt;num&gt;</code> is a number between 1 and 50 inclusive. </p><pre class="fragment"># Assign LEDs
led1="KHIO";
led5="KMMV";
led6="KUAO";
...
</pre><p> It is not necessary to assign LEDs sequentially. Unassigned LEDs will just remain off.</p>
<p >PiWx provides a <code>brightness</code> option with 256 levels of brightness where 0 or <code>off</code> is off and 255 is full intensity. </p><pre class="fragment"># Set LED brightness
brightness=64;
</pre><p> By default, PiWx considers Civil Twilight as day. PiWx will switch an airport LED to day brightness at the beginning of local Civil Twilight and switch the LED to night brightness at the end of local Civil Twilight. The <code>nightbrightness</code> option controls the brightness of LEDs for airports where the local time is night. </p><pre class="fragment"># Set night brightness
nightbrightness=8;
</pre><p> PiWx provides a <code>daylight</code> option to control the length of the day. This option can be one of: <code>official</code>, <code>civil</code>, <code>nautical</code>, or <code>astronomical</code>. These values represent respectively: sunrise to sunset, Civil Twilight, Nautical Twilight, and Astronomical Twilight. </p><pre class="fragment"># Change daylight to Nautical Twilight
daylight=nautical;
</pre><p> The <code>drawglobe</code> option enables the display of a day/night rendering of Earth that centers on the currently displayed station and depicts the Civil, Nautical, and Astronomical twilight bands. The globe displays by default, but can be disabled by setting <code>drawglobe</code> to <code>off</code>. </p><pre class="fragment"># Disable day/night globe
drawglobe=off;
</pre><p> Flight category colors, both LED and weather display, are currently fixed to the US National Weather Service colors: Green (VFR), Blue (Marginal VFR), Red (IFR), and Purple (Low IFR). The <code>highwindspeed</code> option may be used to color airports using Yellow if the wind or gust speed meets or exceeds the setting. By default, this value is 25 knots. </p><pre class="fragment"># Set high-wind threshold
highwindspeed=30;
</pre><p> Setting <code>highwindspeed</code> to <code>off</code> disables the high-wind warning: </p><pre class="fragment"># Disable high-wind warning
highwindspeed=off;
</pre><p> The <code>highwindblink</code> option enables alternating airports between the high-wind warning and the flight category color. For example, with blinking enabled, a VFR airport with high winds will alternate between Green and Yellow. </p><pre class="fragment"># Enable high-wind blinking
highwindblink=on;
</pre><p> Setting <code>highwindblink</code> to <code>off</code> disables blinking and airports with high winds will just display Yellow: </p><pre class="fragment"># Disable high-wind blinking
highwindblink=off;
</pre><p> By default, PiWx uses GPIO18 and DMA Channel 10 to drive the LED string. These may be configured using the following options: </p><pre class="fragment"># Set LED GPIO pin to GPIO12 (BE CAREFUL).
ledpin=12;
# Set LED DMA channel (BE CAREFUL)
leddma=10;
</pre><p> BE EXTREMEMLY CAREFUL when choosing the DMA channel. Read up on the available DMA channels. PiWx currently only supports GPIO12 and GPIO18 (PWM0). The default options are the safest. However, if the PiTFT display is attached, it will use GPIO18 and the LED string will need to use GPIO12.</p>
<p >PiWx can log basic events to <code>&lt;prefix&gt;/var/piwx/piwx.log</code>. The logger supports four levels of output: <code>quiet</code> (default), <code>warning</code>, <code>info</code>, and <code>debug</code>. Each level of debug suppresses the levels above it, e.g. <code>warning</code> suppresses <code>info</code> and <code>debug</code> messages. </p><pre class="fragment"># Log warning and informational messages
loglevel=info;
</pre> <h1>Running Automatically </h1>
<p >To run PiWx automatically on boot, refer to the sample service file in the repository under <code>doc/systemd</code>. This file must be placed in <code>/lib/systemd/system</code> and renamed to <code>piwx.service</code>.</p>
<p >Use <code>sudo systemctl start piwx.service</code> to test starting PiWx and use <code>sudo systemctl stop piwx.service</code> to stop it. To enable automatically starting PiWx on boot, use <code>sudo systemctl enable piwx.service</code>.</p>
<h1>PiTFT Notes </h1>
<p >The Adafruit installer does not always configure the PiTFT overlay correctly. On a Raspberry Pi 3 B+, the following options in <code>/boot/firmware/config.txt</code> work for Raspberry Pi OS 12 (Bookworm): </p><pre class="fragment">dtparam=i2c_arm=on
dtparam=i2s=on
dtparam=spi=on

hdmi_force_hotplug=0

# NOTE: Use whatever rotation value is needed.
# NOTE: The Adafruit installer adds `drm` which should not be used.
# NOTE: Lower performance is fine.
dtoverlay=pitft28-resistive,rotate=270,speed=25000000,fps=20
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
